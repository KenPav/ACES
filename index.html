
<!-- FBGC ACE Golf League Program-->
<html> 
<head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">


</head>
 <body>
    <p align="center"> 
    <!--This draws the Canvas on the webpage -->
      <canvas id="mycanvas"></canvas> 
    </p>
 </body>
 
 <!-- Run all the JavaScript stuff -->
 <!-- Include the processing.js library -->
 <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
 <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script>


    
 <script>
 


    var ACE = function(processingInstance) {
     with (processingInstance) {

        size(800,1200);
        
        frameRate(30);
      
        // ProgramCodeGoesHere

         var vers = "04Feb22/16:31";
         var temp = 0;
         var temp2 = 0;
         var FirstColor = color(0, 0, 0);
         var SecondColor = color(255,0,0);
         var ThirdColor = color(70,50,168);
         var BoxColor = color(255,255,255);
         var SelectBoxColor = color(0,255,200);
         var BackColor = color(180,200,240);
         stroke(FirstColor);
         strokeWeight(2);
         var SameCourse = 1;
         var PlayerCount=0;
         var NameCount=0;
         var HCPCount=0;
         var Lat = 0;
         var Long = 0;
         var holeLat = 0;
         var holeLong = 0;
         var dist = 0;
         var closestHole = 0;
         var startLocation = 0;

         var isVert=1;
         var myWidth=window.innerWidth;
         var myHeight=window.innerHeight;
         var xAdj=1;
         var yAdj=1;
         var xZoom=1;
         var yZoom=1;
         var xOrig=800;
         var yOrig=1000;

         background(BackColor);
         var monthNames = ["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "];


         // Strokes-Par+4 = Point Value in PlayerHoleScore and TotalPoints Arrays
         const PointValue = [10,8,6,4,2,1,0,0,0,0];

         //TotalStrokes Array F,B,T 4 Players and Round Par
         const TotalStrokes = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
         //TotalPoints Array F,B,T Points, 4 Players plus Team Total
         const TotalPoints = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

        // Courses: 0=South 1=North 2=West
        // Par Element: 0-8=South 9-17=North 18-27=West
        // Par Element Values: Courses*9 + Hole Number - 1
         const HolePar = [5,4,3,5,4,4,3,4,4,4,5,3,4,4,4,4,3,4,4,5,4,4,5,3,4,5,3];
         const GreenLat = [30.605128,30.603087,30.603351,30.600480,30.603116,30.604636,30.603694,30.606282,30.608712,30.614216,30.618367,30.619845,30.617919,30.615451,30.611984,30.614986,30.613946,30.611035,30.609564,30.614618,30.617760,30.619054,30.619535,30.618533,30.615434,30.610551,30.610456];
         const GreenLong = [-81.447887,-81.451858,-81.453446,-81.457491,-81.456915,-81.451931,-81.449889,-81.451111,-81.447118,-81.446701,-81.446525,-81.445566,-81.449169,-81.447826,-81.447217,-81.448222,-81.448725,-81.447218,-81.450770,-81.450190,-81.450959,-81.453633,-81.448711,-81.449986,-81.449303,-81.449220,-81.447025];
         const GreenDistance = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
         const Courses = ["South","North","West"];
         const SummaryLabel = ["","","Total Round"];



        // Up To Four Players With Their Total Course Handicap
        // 
         const PlayerName = ["","","","","Team"];
         const PlayerCourseHandicap = [0,0,0,0];
         const ReqPts = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        // 
        // Up To 4 Players(0-3), 18 Hole Strokes Entry per Player
        // PlayerScore is up to 4 players plus team total
        // Index = Player#*18 + Hole Number - 1
         const PlayerHoleStrokes = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
         const PlayerHoleScore = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];



         function doOnOrientationChange() {
               console.log("availWidth, availHeight: ",window.screen.availWidth,window.screen.availHeight);
             switch(window.orientation) {
               case 90:
         //        alert('landscape');
                  isVert=0;
                  myWidth=Math.min(yMin,window.innerWidth);
                  myHeight=Math.min(xMin.window.innerHeight);
//                  myWidth=window.innerWidth;
//                  myHeight=window.innerHeight;
                  xZoom=1;
                  yZoom=1;
                  console.log("case=90, myWidth, myHeight: ",myWidth,myHeight);
                 break;
               case -90:
         //        alert('landscape');
                  isVert=0;
                  myWidth=Math.min(yMin,window.innerWidth);
                  myHeight=Math.min(xMin.window.innerHeight);
//                  myWidth=window.innerWidth;
//                  myHeight=window.innerHeight;
                  xZoom=1;
                  yZoom=1;
                  console.log("case=-90, myWidth, myHeight: ",myWidth,myHeight);
                  break;
               case 0:
         //        alert('portrait');
                  isVert=1;
                  myWidth=Math.min(xMin,window.innerWidth);
                  myHeight=Math.min(yMin.window.innerHeight);
//                  myWidth=window.innerWidth;
//                  myHeight=window.innerHeight;
                  xZoom=1;
                  yZoom=1;
                  console.log("case=0, myWidth, myHeight: ",myWidth,myHeight);
                  break;
               case 180:
         //        alert('portrait');
                  isVert=1;
                  myWidth=Math.min(xMin,window.innerWidth);
                  myHeight=Math.min(yMin.window.innerHeight);
//                  myWidth=window.innerWidth;
//                  myHeight=window.innerHeight;
                  xZoom=1;
                  yZoom=1;
                  console.log("case=180, myWidth, myHeight: ",myWidth,myHeight);
                  break;
               default:
                 break;
             }
         }

         var ScreenSelect = function() {
            fill(BoxColor);

            rect(0*xAdj,850*yAdj,200*xAdj,100*yAdj);
            rect(200*xAdj,850*yAdj,200*xAdj,100*yAdj);
            rect(400*xAdj,850*yAdj,200*xAdj,100*yAdj);           
            rect(600*xAdj,850*yAdj,200*xAdj,100*yAdj);

            textSize(50*xAdj);
            textAlign(CENTER);
            fill(FirstColor);

            text("Setup",100*xAdj,915*yAdj);
            text("Scores",300*xAdj,915*yAdj);
            text("Score",500*xAdj,895*yAdj);
            text("Card",500*xAdj,935*yAdj);
            text("Results",700*xAdj,915*yAdj);
            textSize(35*xAdj);
            text("Vers: "+vers,400*xAdj,985*yAdj);

            text("xM,yM,iW,iH: "+xMin+", "+yMin+", "+window.innerWidth+", "+window.innerHeight,400*xAdj,845*yAdj);

            textSize(50*xAdj);
         }



//       AceScreen = 0
//       Starting Screen

         function localData() {
            window.addEventListener('orientationchange', doOnOrientationChange);

            xAdj=1;
            yAdj=1;
            xOrig=800;
            yOrig=1000;
            myWidth=Math.min(xMin,innerWidth);
            if(myWidth<xOrig) {
               xAdj=(myWidth/xOrig)*xZoom;
               yAdj=1;
            }
            size(xOrig*xAdj,yOrig*yAdj);
            background(BackColor);
            fill(BoxColor);
            rect(50*xAdj,200*yAdj,325*xAdj,100*yAdj);
            rect(425*xAdj,200*yAdj,325*xAdj,100*yAdj);
            fill(FirstColor);
            textSize(45*xAdj);
            textAlign(CENTER);
            if(window.localStorage.getItem('PD')===null) {
               AceScreen=1;
               draw();
            }
            var pData=JSON.parse(window.localStorage.getItem('PD'));
            pData = new Date(pData);
            text("Continue With",212*xAdj,240*yAdj);
            text("Previous Setup",212*xAdj,285*yAdj);
            text("Clear",588*xAdj,240*yAdj);
            text("Previous Setup",588*xAdj,285*yAdj);
            text("Previous Round Data Stored at:",400*xAdj,90*yAdj);
            text(monthNames[pData.getMonth()]+pData.getDate()+", "+pData.getFullYear()+" @ "+pData.getHours()+":"+pData.getMinutes()+":"+pData.getSeconds(),400*xAdj,150*yAdj);
         }

         function trackLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(myPosition,displayError,{enableHighAccuracy: true});
            } else { 
                console.log("Geolocation is not supported by this browser.");
            }
         }

         function myPosition(position) {
            myLat = position.coords.latitude;
            myLong = position.coords.longitude;           
         }

         function displayError(){
            
         }



//       AceScreen = 1
//       Select Courses (CourseSet=0)
//       Select Number of Players (CourseSet=1)
//       Enter Player Names and Course Handicaps (CourseSet=2)
//       Display Player Names and Course Handicaps (CourseSet=3)

         var enterSetup = function() {

            console.log(window.screen.availWidth,window.screen.availHeight,window.screen.width,window.screen.height,window.outerWidth,window.outerHeight);

//          Begin Tracking Location
            
            if(startLocation===0) {
               trackLocation();
               setInterval(trackLocation,5000);
               startLocation=1;
            }            


            xAdj=1;
            yAdj=1;
            xOrig=800;
            yOrig=1000;
            myWidth=Math.min(xMin,innerWidth);
            if(myWidth<xOrig) {
               xAdj=(myWidth/xOrig)*xZoom;
               yAdj=1;
            }
            size(xOrig*xAdj,yOrig*yAdj);
            background(BackColor);
            ScreenSelect();
            if (SameCourse===0) {
               textSize(35*xAdj);
               fill(255,0,0);
               text("Select Different Front and Back Courses!",400*xAdj,450*yAdj);
            }
            textSize(50*xAdj);
            textAlign(CENTER);
            if(CourseSet===0) {

//             SELECT FRONT COURSE
               fill(FirstColor);
               text("Select Front 9 Course ",400*xAdj,60*yAdj);
               if (Front===0) {
                  fill(SelectBoxColor);
               } else { 
                  fill(BoxColor);
               }
               rect(100*xAdj,70*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("South",200*xAdj,125*yAdj);
               if (Front===1) {
                  fill(SelectBoxColor);
               } else { 
                  fill(BoxColor);
               }                  
               rect(300*xAdj,70*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("North",400*xAdj,125*yAdj);
               if (Front===2) {
                  fill(SelectBoxColor);
               } else { 
                  fill(BoxColor);
               }                  
               rect(500*xAdj,70*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("West",600*xAdj,125*yAdj);


//             SELECT BACK COURSE    
               fill(FirstColor);
               text("Select Back 9 Course ",400*xAdj,190*yAdj);
               if (Back===0) {
                  fill(SelectBoxColor);
               } else { 
                  fill(BoxColor);
               }                  
               rect(100*xAdj,200*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("South",200*xAdj,255*yAdj);
               if (Back===1) {
                  fill(SelectBoxColor);
               } else { 
                  fill(BoxColor);
               }                                    
               rect(300*xAdj,200*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("North",400*xAdj,255*yAdj);
               if (Back===2) {
                  fill(SelectBoxColor);
               } else { 
                  fill(BoxColor);
               }                                    
               rect(500*xAdj,200*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("West",600*xAdj,255*yAdj);
               fill(BoxColor);
               rect(300*xAdj,300*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("Continue",400*xAdj,355*yAdj);
               fill(BoxColor);
               rect(300*xAdj,500*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("Restart",400*xAdj,555*yAdj);
            }

//       Select Number of Players (CourseSet=1)

            if (CourseSet===1) {
               for (var i=0; i<15; i++) {
                  ReqPts[i] = 0;
               }
               background(BackColor);
               text("Number of Players",400*xAdj,100*yAdj);
               textSize(50*xAdj);
               j=NumberOfPlayers;
               for(i=0; i<4; i++) {
                  fill(BoxColor);
                  if(i===j-1) {
                     fill(SelectBoxColor);
                  }
                  rect(200*xAdj+i*100*xAdj,200*yAdj,100*xAdj,100*yAdj);
                  fill(FirstColor);
                  text(i+1,250*xAdj+i*100*xAdj,270*yAdj);
               }
               return;
            }

//       Enter Player Names and Course Handicaps (CourseSet=2)

            if(CourseSet===2) {
               if (PlayerCount < NumberOfPlayers) {
                  if(NameCount===PlayerCount) {
                     PlayerName[PlayerCount]=prompt("Player #"+(PlayerCount+1).toString()+" Name: "+PlayerName[PlayerCount],PlayerName[PlayerCount].toString());
                     NameCount=NameCount+1;

                  }
                  if(HCPCount===PlayerCount) {

                     text("Player #"+PlayerCount+1,", "+PlayerName[PlayerCount]+", Course Handicap",400*xAdj,100);
                     for (i=0; i<10; i++) {
                        for (j=0; j<4; j++) {
                           fill(BoxColor);
                           if(PlayerCourseHandicap[HCPCount]===(i+j*10)) {
                              fill(SelectBoxColor);
                           }
                           rect(0+i*80*xAdj,200*yAdj+j*80*yAdj,80*xAdj,80*yAdj);
                           fill(FirstColor);
                           text(0+i+j*10,40*xAdj+i*80*xAdj,265*yAdj+j*80*yAdj);
                        }
                     }
                  }
               }
               else {
                  CourseSet=3;
               }
               return;
            }

//       Display Player Names, Course Handicaps & Required Points (CourseSet=3)

            if (CourseSet===3) {
               fill(BoxColor);
               rect(0*xAdj,200*yAdj,200*xAdj,100*yAdj);
               rect(200*xAdj,200*yAdj,200*xAdj,100*yAdj);
               rect(400*xAdj,200*yAdj,200*xAdj,100*yAdj);
               rect(600*xAdj,200*yAdj,200*xAdj,100*yAdj);
               fill(FirstColor);
               text("Player",100*xAdj,270*yAdj);
               text("Course",300*xAdj,250*yAdj);
               text(Courses[Front],500*xAdj,250*yAdj);
               text(Courses[Back],700*xAdj,250*yAdj);
               text("Hcp",300*xAdj,290*yAdj);
               text("Points",500*xAdj,290*yAdj);
               text("Points",700*xAdj,290*yAdj);
               for (var i = 0; i < NumberOfPlayers; i++) {
                  fill(BoxColor);
                  rect(0*xAdj,300*yAdj+i*70*yAdj,200*xAdj,70);
                  rect(200*xAdj,300*yAdj+i*70*yAdj,200*xAdj,70*yAdj);
                  rect(400*xAdj,300*yAdj+i*70*yAdj,200*xAdj,70*yAdj);
                  rect(600*xAdj,300*yAdj+i*70*yAdj,200*xAdj,70*yAdj);
                  if(i===0 || i===2) {
                     fill(SecondColor);
                  }
                  else {
                     fill(FirstColor);
                  }
                  text(PlayerName[i],100*xAdj,355*yAdj+i*70*yAdj);
                  text(PlayerCourseHandicap[i],300*xAdj,355*yAdj+i*70*yAdj);
                  text(ReqPts[i*3],500*xAdj,355*yAdj+i*70*yAdj);
                  text(ReqPts[i*3+1],700*xAdj,355*yAdj+i*70*yAdj);
               }
               fill(BoxColor);
               rect(300*xAdj,600*yAdj,200*xAdj,70*yAdj);
               fill(FirstColor);
               text("Continue",400*xAdj,655*yAdj);
            }
         };      
         

//       AceScreen = 2;
//       Enter Player Scores for each Hole, Display Team Points      

         var enterStrokes = function(Hole) {
            console.log("at enter strokes");
            console.log("myWidth & myHeight",myWidth,myHeight)

            GreenDist();
            xAdj=1;
            yAdj=1;
            xOrig=800;
            yOrig=1000;
            myWidth=Math.min(xMin,innerWidth);
            if(myWidth<xOrig) {
               xAdj=(myWidth/xOrig)*xZoom;
               yAdj=1;
            }
            size(xOrig*xAdj,yOrig*yAdj);
            ScreenSelect();
            textSize(50*xAdj);
            textAlign(CENTER);
            if(HoleNum===closestHole) {
               fill(SecondColor);
            } else{
               fill(FirstColor);
            }
            text("Hole #"+HoleNum,400*xAdj,65*yAdj)
            if(HoleNum<=9) {
               text("Front 9: "+Courses[Front]+" #"+HoleNum+" / Par "+HolePar[(Front*9)+HoleNum-1],400*xAdj,125);
            }
            else {
               text("Back 9: "+Courses[Back]+" #"+(HoleNum-9)+" / Par "+HolePar[(Back*9)+HoleNum-10],400*xAdj,125);
            }
            fill(FirstColor);
            text("Select Hole Score for Each Player",400*xAdj,185);
            for (var i = 0; i < NumberOfPlayers; i++) {
               fill(BoxColor);
               rect(0*xAdj,200*yAdj+i*80*yAdj,220*xAdj,80*yAdj);
               if(i===0 || i===2) {
                  fill(SecondColor);
               }
               else {
                  fill(FirstColor);
               }
               text(PlayerName[i],110*xAdj,265*yAdj+i*80*yAdj);
               for (var j = 0; j < 8; j++) {
                  if(PlayerHoleStrokes[i*18+HoleNum-1]===j+1) {
                     fill(SelectBoxColor);
                     rect(220*xAdj+j*70*xAdj,200*yAdj+i*80*yAdj,70*xAdj,80*yAdj);
                  }
                  else {
                     fill(BoxColor);
                     rect(220*xAdj+j*70*xAdj,200*yAdj+i*80*yAdj,70*xAdj,80*yAdj);
                  }
                  if(i===0 || i===2) {
                     fill(SecondColor);
                  }
                  else {
                     fill(FirstColor);
                  }
                  text(j+1,255*xAdj+j*70*xAdj,265*yAdj+i*80*yAdj);
               }

            }

            fill(BoxColor);
            rect(50*xAdj,550*yAdj,200*xAdj,80*yAdj);
            rect(550*xAdj,550*yAdj,200*xAdj,80*yAdj);
            rect(275*xAdj,550*yAdj,250*xAdj,80*yAdj);
            rect(50*xAdj,650*yAdj,700*xAdj,80*yAdj);
            fill(FirstColor);
            text("Previous",150*xAdj,615*yAdj);
            text("Next",650*xAdj,615*yAdj);
            if(HoleNum===closestHole) {
               fill(SecondColor);
               text("This hole is the nearest hole",400*xAdj,715*yAdj);
            } 
            else {
               text("Jump to Nearest Hole (#"+closestHole+")",400*xAdj,715*yAdj);               
            }
            text("Points: "+PlayerHoleScore[4*18+HoleNum-1],400*xAdj,615*yAdj);
            text(GreenDistance[HoleNum-1].toFixed(0)+" yards to hole.",400*xAdj,800*yAdj);            
         };

//       Display Score Card      

         var showScoreCard = function() {

            xOrig=1250;
            yOrig=1000;
            xAdj=xMin/xOrig;
            yAdj=1;
            if(isVert===0 & myWidth<xOrig) {
               xAdj=(xWidth/xOrig)*xZoom;
               yAdj=1;
            }
            size(xOrig*xAdj,yOrig*yAdj);


//            size(1250,1200);
            ScreenSelect();
            DoCalculations();
            textSize(35*xAdj);
            textAlign(CENTER);
            fill(BoxColor);
            rect(0*xAdj,0*yAdj,170*xAdj,50*yAdj);
            rect(170*xAdj,0*yAdj,10*50*xAdj,50*yAdj);
            rect(170*xAdj+10*50*xAdj,0*yAdj,10*50*xAdj,50*yAdj);
            rect(170*xAdj+20*50*xAdj,0*yAdj,50*xAdj,50*yAdj);
            fill(FirstColor);
            text("Players",85*xAdj,40*yAdj);
            text("Front 9: "+Courses[Front],420*xAdj,40*yAdj);
            text("Back 9: "+Courses[Back],920*xAdj,40*yAdj);
            text("T",1195*xAdj,40*yAdj);
            fill(BoxColor);
            for (var j=0; j<6; j++) {
               rect(0*xAdj,50*yAdj+j*50*yAdj,170*xAdj,50*yAdj);
               for (var i=0; i<21; i++) {
                  //Front 9, Front Total, Back 9, Back Total, Round Total
                  rect(170*xAdj+i*50*xAdj,50*yAdj+j*50*yAdj,50*xAdj,50*yAdj);
               }
            }
            fill(FirstColor);
            text("Par",85*xAdj,90);
            for (var i=1; i<19; i++) {
               if (i<10) {
                  text(HolePar[Front*9+i-1],195*xAdj+(i-1)*50*xAdj,90*yAdj);
               }
               else {
                  text(HolePar[Back*9+i-10],195*xAdj+i*50*xAdj,90*yAdj);  
               }
            }
            text(TotalStrokes[12],645*xAdj,90*yAdj);
            text(TotalStrokes[13],1145*xAdj,90*yAdj);
            text(TotalStrokes[14],1195*xAdj,90*yAdj);

            for (var j=0; j<5; j++) {
               for (var i=0; i<21; i++) {

                  if(i===0 && j===1) {
                     fill(FirstColor);
                     text("Hole #",85*xAdj,140*yAdj);
                     for (var k=1; k<10; k++) {
                        text(k,195*xAdj+(k-1)*50*xAdj,140*yAdj);
                     }
                     for (var k=10; k<19; k++) {
                        text(k-9,695*xAdj+(k-10)*50*xAdj,140*yAdj);
                     }
                  }
                  if((j-1)===0 || (j-1)===2) {
                     fill(SecondColor);
                  }
                  else {
                     fill(FirstColor);
                  }
                  if ((j===0 && (i===9 || i>18))) {
                     if (i===9) {
                        text("F",195*xAdj+i*50*xAdj,140*yAdj+j*50*yAdj);
                     }
                     if (i===19) {
                        text("B",195*xAdj+i*50*xAdj,140*yAdj+j*50*yAdj);
                     }
                     if (i===20) {
                        text("T",195*xAdj+i*50*xAdj,140*yAdj+j*50*yAdj);
                     }
                  }
                  if(j>0 && j<=NumberOfPlayers && i===0) {
                     text(PlayerName[j-1],85*xAdj,140*yAdj+50*j*yAdj);
                  }
                  if(i<9 && j>0) {
                     if(j<=NumberOfPlayers) {
                        text(PlayerHoleStrokes[(j-1)*18+i],195*xAdj+i*50*xAdj,140*yAdj+j*50*yAdj);
                        if (i===8) {
                           text(TotalStrokes[(j-1)*3],195*xAdj+(i+1)*50*xAdj,140*yAdj+j*50*yAdj);
                        }
                     }
                  }
                  if(i>10 && i<20 && j>0) {
                     if(j<=NumberOfPlayers) {
                        text(PlayerHoleStrokes[(j-1)*18+i-2],195*xAdj+(i-1)*50*xAdj,140*yAdj+j*50*yAdj);
                        if (i===19) {
                           text(TotalStrokes[(j-1)*3+1],195*xAdj+(i+0)*50*xAdj,140*yAdj+j*50*yAdj);
                           text(TotalStrokes[(j-1)*3+2],195*xAdj+(i+1)*50*xAdj,140*yAdj+j*50*yAdj);
                        }
                     }
                  }
               }
            }
                       
            fill(BoxColor);
            for (var j=0; j<6; j++) {
               rect(0*xAdj,400*yAdj+j*50*yAdj,170*xAdj,50*yAdj);
               for (var i=0; i<21; i++) {
                  //Front 9, Front Total, Back 9, Back Total, Round Total
                  rect(170*xAdj+i*50*xAdj,400*yAdj+j*50*yAdj,50*xAdj,50*yAdj);
               }
            }                       
            fill(FirstColor);
            for (var j=0; j<7; j++) {
               for (var i=0; i<21; i++) {
                  fill(FirstColor);
                  if(j===0 && i===1) {
                     text("Points",95*xAdj,440*yAdj);
                     for (var k=1; k<10; k++) {
                        text(k,195*xAdj+(k-1)*50*xAdj,440*yAdj);
                     }
                     for (var k=10; k<19; k++) {
                        text(k-9,695*xAdj+(k-10)*50*xAdj,440*yAdj);
                     }
                  }
                  if ((j===0 && (i===9 || i>18))) {
                     if (i===9) {
                        text("F",195*xAdj+i*50*xAdj,440*yAdj+j*50*yAdj);
                     }
                     if (i===19) {
                        text("B",195*xAdj+i*50*xAdj,440*yAdj+j*50*yAdj);
                     }
                     if (i===20) {
                        text("T",195*xAdj+i*50*xAdj,440*yAdj+j*50*yAdj);
                     }
                  }
                  if((j-1)===0 || (j-1)===2) {
                     fill(SecondColor);
                  }
                  else {
                     fill(FirstColor);
                  }                  
                  if(j>0 && j<=NumberOfPlayers && i===0) {
                     text(PlayerName[j-1],85*xAdj,440*yAdj+50*j*yAdj);
                  }
                  if(i<9 && j>0 && j<=NumberOfPlayers) {    
                        text(PlayerHoleScore[(j-1)*18+i],195*xAdj+i*50*xAdj,440*yAdj+j*50*yAdj);
                        if (i===8) {
                           text(TotalPoints[(j-1)*3],195*xAdj+(i+1)*50*xAdj,440*yAdj+j*50*yAdj);
                        }
                  }
                  if(i>10 && i<20 && j>0 && j<=NumberOfPlayers) {
                        text(PlayerHoleScore[(j-1)*18+i-2],195*xAdj+(i-1)*50*xAdj,440*yAdj+j*50*yAdj);
                        if (i===19) {
                           text(TotalPoints[(j-1)*3+1],195*xAdj+(i+0)*50*xAdj,440*yAdj+j*50*yAdj);
                           text(TotalPoints[(j-1)*3+2],195*xAdj+(i+1)*50*xAdj,440*yAdj+j*50*yAdj);
                        }
                  }
                  if(j===5) {
                     fill(ThirdColor);
                     if (i===0) {
                        text("TeamTotal",85*xAdj,440*yAdj+50*j*yAdj);
                     }
                     if(i<9 && j>0) {
                        text(PlayerHoleScore[(j-1)*18+i],195*xAdj+i*50*xAdj,440*yAdj+j*50*yAdj);
                        if (i===8) {
                           text(TotalPoints[(j-1)*3],195*xAdj+(i+1)*50*xAdj,440*yAdj+j*50*yAdj);
                        }
                     }
                     if(i>10 && i<20 && j>0) {
                        text(PlayerHoleScore[(j-1)*18+i-2],195*xAdj+(i-1)*50*xAdj,440*yAdj+j*50*yAdj);
                        if (i===19) {
                           text(TotalPoints[(j-1)*3+1],195*xAdj+(i+0)*50*xAdj,440*yAdj+j*50*yAdj);
                           text(TotalPoints[(j-1)*3+2],195*xAdj+(i+1)*50*xAdj,440*yAdj+j*50*yAdj);
                        }
                     }
                  }
               }
            }
         };

//       Display Front, Back & Total Player & Team Results      

         var showSummary = function() {
            xOrig=1050;
            yOrig=1000;
            xAdj=xMin/xOrig;
            yAdj=1;
            if(isVert===0 & xWidth<xOrig) {
               xAdj=(xWidth/xOrig)*xZoom;
               yAdj=1;
            }
            size(xOrig*xAdj,yOrig*yAdj);

//            size(1200,1200);
            ScreenSelect();
            DoCalculations();
            SummaryLabel[0] = Courses[Front];
            SummaryLabel[1] = Courses[Back];
            textSize(35*xAdj);
            textAlign(CENTER);
            fill(BoxColor);
            rect(0*xAdj,100*yAdj,170*xAdj,150*yAdj);
            fill(FirstColor);
            text("Players",85*xAdj,240*yAdj);
            for (var i=0; i<3; i++) {
               fill(BoxColor);
               rect(170*xAdj+i*280*xAdj,100*yAdj,280*xAdj,50*yAdj)
               rect(170*xAdj+i*280*xAdj,150*yAdj,70*xAdj,100*yAdj);
               rect(240*xAdj+i*280*xAdj,150*yAdj,210*xAdj,50*yAdj);
               rect(240*xAdj+i*280*xAdj,200*yAdj,70*xAdj,50*yAdj);
               rect(310*xAdj+i*280*xAdj,200*yAdj,70*xAdj,50*yAdj);
               rect(380*xAdj+i*280*xAdj,200*yAdj,70*xAdj,50*yAdj);
               fill(FirstColor);
               text(SummaryLabel[i],310*xAdj+i*280*xAdj,140*yAdj);
               text("Points",345*xAdj+i*280*xAdj,190*yAdj);
               textSize(35*xAdj);
               text("Stk",205*xAdj+280*i*xAdj,240*yAdj);
               text("Scr",275*xAdj+i*280*xAdj,240*yAdj);
               text("Rqd",345*xAdj+i*280*xAdj,240*yAdj);
               text("Net",415*xAdj+i*280*xAdj,240*yAdj);
               textSize(35*xAdj);
               
            }
            for (var j=0; j<5; j++) {
               fill(BoxColor);
               rect(0*xAdj,250*yAdj+j*50*yAdj,170*xAdj,50*yAdj);
               if(j===0 || j===2) {
                  fill(SecondColor);
               }
               else if(j===1 || j===3) {
                  fill(FirstColor);
               }
               else {
                  fill(ThirdColor);
               }
               if (j<NumberOfPlayers || j===4) {
                  text(PlayerName[j],85*xAdj,290*yAdj+j*50*yAdj); 
               }
               for (var i=0; i<3; i++) {
                  fill(BoxColor);
                  rect(170*xAdj+i*280*xAdj,250*yAdj+j*50*yAdj,70*xAdj,50*yAdj);
                  rect(240*xAdj+i*280*xAdj,250*yAdj+j*50*yAdj,70*xAdj,50*yAdj);
                  rect(310*xAdj+i*280*xAdj,250*yAdj+j*50*yAdj,70*xAdj,50*yAdj);
                  rect(380*xAdj+i*280*xAdj,250*yAdj+j*50*yAdj,70*xAdj,50*yAdj);
                  if(j===0 || j===2) {
                     fill(SecondColor);
                  }
                  else if(j===1 || j===3) {
                     fill(FirstColor);
                  }
                  else {
                     fill(ThirdColor);
                  }
                     if (j!=4 && j<NumberOfPlayers) {
                        text(TotalStrokes[i+j*3],205*xAdj+i*280*xAdj,290*yAdj+j*50*yAdj);
                  }
                  if (j<NumberOfPlayers || j===4) {
                     text(TotalPoints[i+j*3],275*xAdj+i*280*xAdj,290*yAdj+j*50*yAdj);
                     text(ReqPts[i+j*3],345*xAdj+i*280*xAdj,290*yAdj+j*50*yAdj);
                     text(TotalPoints[i+j*3]-ReqPts[i+j*3],415*xAdj+i*280*xAdj,290*yAdj+j*50*yAdj);
                  }
               }
            }
         };

//       Store Current Data for Recovery if App is Restarted

         storeIt = function() {
            window.localStorage.setItem('PD',JSON.stringify(new Date())); 
            window.localStorage.setItem('PHS',JSON.stringify(PlayerHoleStrokes));
            window.localStorage.setItem('pName',JSON.stringify(PlayerName));
            window.localStorage.setItem('RqPt',JSON.stringify(ReqPts));
            window.localStorage.setItem('PCH',JSON.stringify(PlayerCourseHandicap));
            window.localStorage.setItem('NumP',JSON.stringify(NumberOfPlayers));
            window.localStorage.setItem('F',JSON.stringify(Front));
            window.localStorage.setItem('B',JSON.stringify(Back));
            window.localStorage.setItem('HN',JSON.stringify(HoleNum)); 
         }

//       Calculate Player & Team Hole Scores

         calcScores = function() {
            if(NumberOfPlayers>0) {
               for (var i=0; i<90; i++) {
                  PlayerHoleScore[i]=0;
               }
               for (var i = 0; i < NumberOfPlayers; i++) {
                  for (var j = 0; j < 18; j++) {
                     if(PlayerHoleStrokes[i*18+j]>0) {
                        if(j<9) {
                           PlayerHoleScore[i*18+j]=PointValue[PlayerHoleStrokes[i*18+j]-HolePar[Front*9+j]+4];
                        }
                        else {
                           PlayerHoleScore[i*18+j]=PointValue[PlayerHoleStrokes[i*18+j]-HolePar[Back*9+j-9]+4];   
                        }      
                        PlayerHoleScore[4*18+j]=PlayerHoleScore[4*18+j]+PlayerHoleScore[i*18+j];
                     }
                  }
               }
            }
         }

//       Calculate Closest Hole Information

         GreenDist = function() {
            console.log("at GreenDist");
            console.log("myWidth & myHeight",myWidth,myHeight)

            for(i=0; i<18; i++) {
               if(i<9) {
                  Lat = GreenLat[Front*9+i];
                  Long = GreenLong[Front*9+i];
               }
               else {
                  Lat = GreenLat[Back*9+i-9];
                  Long = GreenLong[Back*9+i-9];
               }
               distance();
               GreenDistance[i]=dist;
            }
            dist = 1000000000;
            for(i=0; i<18; i++) {
               if(GreenDistance[i]<dist) {
                  closestHole=i+1;
                  dist=GreenDistance[i];
               }
            }
            console.log("Closest Hole: ",closestHole);
         }

//      Green distance calculations

        function distance() {
            if ((Lat === myLat) && (Long === myLong)) {
                dist=0
                return dist;
            }
            else {
                var radlat1 = Math.PI * Lat/180;
                var radlat2 = Math.PI * myLat/180;
                var theta = Long-myLong;
                var radtheta = Math.PI * theta/180;
                dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
                if (dist > 1) {
                    dist = 1;
                }
                dist = Math.acos(dist);
                dist = dist * 180/Math.PI;
                dist = dist * 60 * 1.1515 * 5280 / 3;
                return dist;
            }
        }

//       Prepare Player and Team Hole Scores and Points      

         var DoCalculations = function() {
            for (var i=0; i<15; i++) {
               TotalPoints[i] = 0;
               TotalStrokes[i] = 0;
            }
            for (var i=0; i<4; i++) {
               for (var j=1; j<19; j++) {
                  if (j<10) {
                     TotalStrokes[i*3] = TotalStrokes[i*3] + PlayerHoleStrokes[i*18+j-1];
                     TotalPoints[i*3] = TotalPoints[i*3] + PlayerHoleScore[i*18+j-1];
                  }
                  else {
                     TotalStrokes[i*3+1] = TotalStrokes[i*3+1] + PlayerHoleStrokes[i*18+j-1];
                     TotalPoints[i*3+1] = TotalPoints[i*3+1] + PlayerHoleScore[i*18+j-1];
                  }
               }
               TotalStrokes[i*3+2] = TotalStrokes[i*3] + TotalStrokes[i*3+1];
               TotalPoints[i*3+2] = TotalPoints[i*3] + TotalPoints[i*3+1];
            }

            for (var i=0; i<4; i++) {
               TotalPoints[12] = TotalPoints[12] + TotalPoints[i*3];
               TotalPoints[13] = TotalPoints[13] + TotalPoints[i*3+1];
               TotalPoints[14] = TotalPoints[14] + TotalPoints[i*3+2];
            }
            for (var i=0; i<9; i++) {
               TotalStrokes[12] = TotalStrokes[12] + HolePar[Front*9+i];
               TotalStrokes[13] = TotalStrokes[13] + HolePar[Back*9+i];
            }
            TotalStrokes[14] = TotalStrokes[12] + TotalStrokes[13];
         };

//       User Mouse Click Processing Section 

         mouseClicked = function() {
            background(BackColor);

            // Choose Setup Page
            if(mouseX>=0*xAdj && mouseX<=200*xAdj && mouseY>=850*yAdj && mouseY<=950*yAdj) {
               CourseSet=0;
               AceScreen=1;
            }
            // Choose Strokes Page
            if(mouseX>=200*xAdj && mouseX<=400*xAdj && mouseY>=850*yAdj && mouseY<=950*yAdj) {
               AceScreen=2;
            }
            // Choose Score Card Page          
            if(mouseX>=400*xAdj && mouseX<=600*xAdj && mouseY>=850*yAdj && mouseY<=950*yAdj) {
               AceScreen=3;
            } 
            // Choose Result Page           
            if(mouseX>=600*xAdj && mouseX<=800*xAdj && mouseY>=850*yAdj && mouseY<=950*yAdj) {
               AceScreen=4;
            }                        

            // Recall Previous Data
            if(AceScreen===0) {
               if(mouseX>=50*xAdj && mouseX<=375*xAdj && mouseY>=200*yAdj && mouseY<=300*yAdj) {
                  var F1=JSON.parse(window.localStorage.getItem('F'));
                  Front = Number(F1);
                  var B1=JSON.parse(window.localStorage.getItem('B'));
                  Back = Number(B1);
                  var HN1=JSON.parse(window.localStorage.getItem('HN'));
                  HoleNum = Number(HN1);
                  var NoP=JSON.parse(window.localStorage.getItem('NumP'));
                  NumberOfPlayers=Number(NoP);
                  var PN1=JSON.parse(window.localStorage.getItem('pName'));
                  var PCH1=JSON.parse(window.localStorage.getItem('PCH'));
                  var RqPt1=JSON.parse(window.localStorage.getItem('RqPt'));
                  var PHS1 =JSON.parse(window.localStorage.getItem('PHS'));
                  for (i=0; i<72; i++) {
                     PlayerHoleStrokes[i]=Number(PHS1[i]);
                     if(i<4) {
                        PlayerCourseHandicap[i]=Number(PCH1[i]);
                     }
                     if(i<5) {
                        PlayerName[i]=PN1[i];
                     }
                     if(i<15) {
                        ReqPts[i]=Number(RqPt1[i]);
                     }
                  }
                  calcScores();                  
                  AceScreen=1;
                  draw()
               }
               // Clear Previous Data
               if(mouseX>=425*xAdj && mouseX<=750*xAdj && mouseY>=200*yAdj && mouseY<=300*yAdj) {
                  window.localStorage.clear();
                  AceScreen=1;
                  draw()
               }
               return;
            }
            if(AceScreen===1 && CourseSet===0) {
               for (i=0; i<3; i++) {
                  // Select FRONT & BACK Courses
                  SameCourse=1;
                  if(mouseX>=100*xAdj+200*i*xAdj && mouseX<=300*xAdj+200*i*xAdj && mouseY>=70*yAdj && mouseY<=140*yAdj) {
                     Front=i;
                  }
                  if(mouseX>=100*xAdj+200*i*xAdj && mouseX<=300*xAdj+200*i*xAdj && mouseY>=200*yAdj && mouseY<=270*yAdj) {
                     Back=i;
                  }

               }
               // Continue to Player Data
               if(mouseX>=300*xAdj && mouseX<=500*xAdj && mouseY>=300*yAdj && mouseY<=370*yAdj) {
                  if(Front>=0 && Front<=2 && Back>=0 && Back<=2 && Front!=Back) {
                     CourseSet=1;
                     Restart = 0;
                     storeIt();
                  }
                  else {
                     SameCourse=0;
                  }
               }

               calcScores();


//             Restart - New Game               

               if(mouseX>=300*xAdj && mouseX<=500*xAdj && mouseY>=500*yAdj && mouseY<=570*yAdj) {
                  window.localStorage.clear();
                  Front=3;
                  Back=3;
                  NumberOfPlayers=0;
                  HoleNum=1;
                  for(i=0; i<72; i++) {
                     PlayerHoleStrokes[i]=0;
                     if(i<4) {
                        PlayerName[i]="";
                        if(i===4) {
                           PlayerName[i]="Team";
                        }
                     }
                     if(i<3) {
                        PlayerCourseHandicap[i]=0;
                     }
                     if(i<15) {
                        ReqPts[i]=0;
                     }
                  }
                  for (var i=0; i<90; i++) {
                     PlayerHoleScore[i]=0;
                  }                  
               }
               return;
            }
            if(AceScreen===1 && CourseSet===1) {
               for (i=0; i<4; i++) {
                  if(mouseX>=200*xAdj+i*100*xAdj && mouseX<=300*xAdj+i*100*xAdj && mouseY>=200*yAdj && mouseY<=300*yAdj) {
                     background(BackColor);
                     NumberOfPlayers=i+1;
                     CourseSet=2;
                     PlayerCount=0;
                     NameCount=0;
                     HCPCount=0;
                     storeIt();
                     return;
                  }
               }
            }

            if(AceScreen===1 && CourseSet===2) {

               for (i=0; i<10; i++) {
                  for (j=0; j<4; j++) {
                     if(mouseX>=0*xAdj+80*i*xAdj && mouseX<=80*xAdj+80*i*xAdj && mouseY>=200*yAdj+j*80*yAdj && mouseY<=280*yAdj+j*80*yAdj) {
                        PlayerCourseHandicap[PlayerCount]=i+j*10;

                        temp=floor((36-PlayerCourseHandicap[PlayerCount])/2);
                        temp2=36-(temp*2);
                        if (temp2===PlayerCourseHandicap[PlayerCount]) {
                           ReqPts[PlayerCount*3]=temp;
                           ReqPts[PlayerCount*3+1]=temp;
                        }
                        else {
                           if (Front>Back) {
                              ReqPts[PlayerCount*3]=temp;
                              ReqPts[PlayerCount*3+1]=temp+1;
                           }
                           else {
                              ReqPts[PlayerCount*3]=temp+1;
                              ReqPts[PlayerCount*3+1]=temp;
                           }
                        }
                           ReqPts[PlayerCount*3+2] = ReqPts[PlayerCount*3] + ReqPts[PlayerCount*3+1];
                           ReqPts[12] = ReqPts[12] + ReqPts[PlayerCount*3];
                           ReqPts[13] = ReqPts[13] + ReqPts[PlayerCount*3+1];
                           ReqPts[14] = ReqPts[14] + ReqPts[PlayerCount*3+2];

                        PlayerCount=PlayerCount+1;
                        HCPCount=HCPCount+1
                        storeIt();
                        return;
                     }
                  }
               }
            }

            if(AceScreen===1 && CourseSet===3) {
                  if(mouseX>=300*xAdj && mouseX<=500*xAdj && mouseY>=600*yAdj && mouseY<=670*yAdj) {
                     AceScreen=2
                     storeIt();
                     return;
                  }
               
            }
            // Enter Hole Strokes and Calculate Player Hole Scores
            if(AceScreen===2) {
               for (var i = 0; i < NumberOfPlayers; i++) {
                  for (var j = 0; j < 8; j++) {
                     if(mouseX>=220*xAdj+70*j*xAdj && mouseX<=290*xAdj+70*j*xAdj && mouseY>=200*yAdj+i*80*yAdj && mouseY<=280*yAdj+i*80*yAdj) {
                        PlayerHoleStrokes[i*18+HoleNum-1]=j+1;
                     }
                  }
               }
               //Calculate Team Hole Score and Save Data 
               calcScores();
               window.localStorage.setItem('PHS',JSON.stringify(PlayerHoleStrokes));
               window.localStorage.setItem('HN',JSON.stringify(HoleNum));               

               // Back up to Previous Hole
               if(mouseX>=50*xAdj && mouseX<=250*xAdj && mouseY>=550*yAdj && mouseY<=630*yAdj) { 
                  if(HoleNum>1) {
                        HoleNum=HoleNum-1;
                  }
               }

               // Proceed to Next Hole
               if(mouseX>=550*xAdj && mouseX<=750*xAdj && mouseY>=550*yAdj && mouseY<=630*yAdj) {
                  if(HoleNum<18) {
                     HoleNum=HoleNum+1;
                  }
               }
               if(mouseX>=50*xAdj && mouseX<=700*xAdj && mouseY>=650*yAdj && mouseY<=730*yAdj) {
                  HoleNum=closestHole;
               }                
               draw();
            }            


         };


        // AceScreen Value:
        // 1 = Setup Round with up to 4 Players and Select Front & Back Courses
        // 2 = Add Scores for up to 4 Players for 18 Holes
        // 3 = Display Scorecard for up to 4 Players with Team Points per Hole
        // 4 = Display Results Strokes by Player & Team (Front / Back / Total)


//       ROUND SETUP INITIAL VARIABLES
         var CourseSet = 0;
         var Front = 3;
         var Back = 3;
         var AceScreen = 0;
         var NumberOfPlayers = 0;
         var NoP="0";
         var Restart = 0;

//       SCORE INPUT INITIAL VARIABLES
         var HoleNum = 1;

         var xMin = 0;
         var yMin = 0;
         var startXY = 0;
         
         draw = function() {

            if (startXY===0) {

               if (window.matchMedia("(orientation: portrait)").matches) {
                  // you're in PORTRAIT mode
                  xMin=window.innerWidth;
                  yMin=window.innerHeight;
               }

               if (window.matchMedia("(orientation: landscape)").matches) {
                  // you're in LANDSCAPE mode
                  yMin=window.innerWidth;
                  xMin=window.innerHeight;
               }

               startXY=1;
            }

            if (AceScreen===0) {

               localData();            
            }

            if (AceScreen===1) {
               
               enterSetup();  
            }
            
            if (AceScreen===2) {

               enterStrokes ();

            }
            
            if (AceScreen===3) {

               showScoreCard();
            }
            
            if (AceScreen===4) {

               showSummary();


            }











        };
    }
    };
    // Get the canvas that Processing-js will use
    var canvas = document.getElementById("mycanvas"); 
    // Pass the function sketchProc (defined in myCode.js) to Processing's constructor.
    var processingInstance = new Processing(canvas, ACE); 
 

 </script>

</html>
